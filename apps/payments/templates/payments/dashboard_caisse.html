{% extends 'base.html' %}
{% load gnf %}

{% block title %}Caisse{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div>
        <h1 class="page-title">ğŸ’° Gestion de la Caisse</h1>
        <p class="page-subtitle">Suivez vos entrÃ©es et sorties d'argent</p>
    </div>
    <div class="btn-group">
        {% if caisse %}
            <a href="{% url 'payments:fermer_caisse' caisse.id %}" class="btn btn--danger">ğŸ”’ Fermer la caisse</a>
        {% else %}
            <a href="{% url 'payments:ouvrir_caisse' %}" class="btn btn--primary">ğŸ”“ Ouvrir une caisse</a>
        {% endif %}
    </div>
</div>

<!-- Quick Navigation Tabs -->
<div class="card" style="padding: 12px 16px; margin-bottom: 24px;">
    <div class="btn-group">
        <a href="{% url 'payments:liste_caisses' %}" class="btn btn--ghost btn--sm">ğŸ“ Historique caisses</a>
        <a href="{% url 'payments:liste_sorties' %}" class="btn btn--ghost btn--sm">ğŸ“¤ Sorties</a>
        <a href="{% url 'payments:liste_paiements' %}" class="btn btn--ghost btn--sm">ğŸ’³ Paiements</a>
        <a href="{% url 'payments:liste_types_depense' %}" class="btn btn--ghost btn--sm">ğŸ·ï¸ Types dÃ©pense</a>
        <a href="{% url 'expenses:create_depense' %}" class="btn btn--warning btn--sm">+ Nouvelle dÃ©pense</a>
    </div>
</div>

{% if caisse %}
<!-- Stats Cards pour caisse ouverte -->
<div class="stats-grid">
    <div class="stat-card stat-card--success">
        <div class="stat-card__icon">âœ…</div>
        <div class="stat-card__value">Ouverte</div>
        <div class="stat-card__label">Statut de la caisse</div>
        <span class="badge badge--success" style="margin-top: 8px;">
            Depuis {{ caisse.date_ouverture|date:"d/m/Y H:i" }}
        </span>
    </div>
    
    <div class="stat-card stat-card--primary">
        <div class="stat-card__icon">ğŸ’µ</div>
        <div class="stat-card__value">{{ caisse.solde_actuel|gnf }}</div>
        <div class="stat-card__label">Solde actuel</div>
    </div>
    
    <div class="stat-card stat-card--info">
        <div class="stat-card__icon">ğŸ“Š</div>
        <div class="stat-card__value">{{ caisse.solde_theorique|gnf }}</div>
        <div class="stat-card__label">Solde thÃ©orique</div>
    </div>
    
    <div class="stat-card {% if caisse.difference == 0 %}stat-card--success{% elif caisse.difference > 0 %}stat-card--warning{% else %}stat-card--danger{% endif %}">
        <div class="stat-card__icon">âš–ï¸</div>
        <div class="stat-card__value">{{ caisse.difference|gnf }}</div>
        <div class="stat-card__label">DiffÃ©rence</div>
        {% if caisse.difference == 0 %}
            <span class="badge badge--success" style="margin-top: 8px;">Ã‰quilibrÃ©e</span>
        {% elif caisse.difference > 0 %}
            <span class="badge badge--warning" style="margin-top: 8px;">ExcÃ©dent</span>
        {% else %}
            <span class="badge badge--danger" style="margin-top: 8px;">DÃ©ficit</span>
        {% endif %}
    </div>
</div>

<!-- DÃ©tails et actions -->
<div class="grid grid--2">
    <!-- Derniers paiements -->
    <div class="card">
        <div class="card__header">
            <h3 class="card__title">ğŸ’³ Derniers paiements</h3>
            <a href="{% url 'payments:liste_paiements' %}" class="btn btn--sm btn--ghost">Voir tout</a>
        </div>
        <div class="activity-list">
            {% for paiement in derniers_paiements %}
            <div class="activity-item">
                <div class="activity-item__icon" style="background: rgba(16, 185, 129, 0.15);">ğŸ’³</div>
                <div class="activity-item__content">
                    <div class="activity-item__title">{{ paiement.commande.numero_commande }}</div>
                    <div class="activity-item__time">{{ paiement.date_paiement|timesince }} â€¢ {{ paiement.get_mode_paiement_display }}</div>
                </div>
                <div class="activity-item__amount activity-item__amount--positive">+{{ paiement.montant|gnf }}</div>
            </div>
            {% empty %}
            <div class="empty-state">
                <div class="empty-state__icon">ğŸ’³</div>
                <p class="empty-state__title">Aucun paiement</p>
                <p class="empty-state__description">Les paiements apparaÃ®tront ici</p>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- DerniÃ¨res sorties -->
    <div class="card">
        <div class="card__header">
            <h3 class="card__title">ğŸ“¤ DerniÃ¨res sorties</h3>
            <a href="{% url 'payments:liste_sorties' %}" class="btn btn--sm btn--ghost">Voir tout</a>
        </div>
        <div class="activity-list">
            {% for sortie in dernieres_sorties %}
            <div class="activity-item">
                <div class="activity-item__icon" style="background: rgba(239, 68, 68, 0.15);">ğŸ“¤</div>
                <div class="activity-item__content">
                    <div class="activity-item__title">{{ sortie.motif|truncatechars:30 }}</div>
                    <div class="activity-item__time">{{ sortie.date_sortie|timesince }} â€¢ {{ sortie.type_depense.nom }}</div>
                </div>
                <div class="activity-item__amount activity-item__amount--negative">-{{ sortie.montant|gnf }}</div>
            </div>
            {% empty %}
            <div class="empty-state">
                <div class="empty-state__icon">ğŸ“¤</div>
                <p class="empty-state__title">Aucune sortie</p>
                <p class="empty-state__description">Les dÃ©penses apparaÃ®tront ici</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Actions rapides -->
<div class="card" style="margin-top: 24px;">
    <div class="card__header">
        <h3 class="card__title">âš¡ Actions rapides</h3>
    </div>
    <div class="quick-actions">
        <a href="{% url 'payments:detail_caisse' caisse.id %}" class="quick-action">
            <div class="quick-action__icon" style="background: rgba(59, 130, 246, 0.15); color: #3b82f6;">ğŸ“‹</div>
            <span class="quick-action__label">Voir les dÃ©tails</span>
        </a>
        <a href="{% url 'expenses:create_depense' %}" class="quick-action">
            <div class="quick-action__icon" style="background: rgba(239, 68, 68, 0.15); color: #ef4444;">ğŸ“¤</div>
            <span class="quick-action__label">Nouvelle dÃ©pense</span>
        </a>
        <a href="{% url 'dashboard:export_ventes_excel' %}" class="quick-action">
            <div class="quick-action__icon" style="background: rgba(16, 185, 129, 0.15); color: #10b981;">ğŸ“Š</div>
            <span class="quick-action__label">Export Excel</span>
        </a>
        <a href="{% url 'dashboard:export_ventes_pdf' %}" class="quick-action">
            <div class="quick-action__icon" style="background: rgba(239, 68, 68, 0.15); color: #ef4444;">ğŸ“„</div>
            <span class="quick-action__label">Export PDF</span>
        </a>
    </div>
</div>

{% else %}
<!-- Pas de caisse ouverte -->
<div class="card" style="text-align: center; padding: 60px 40px;">
    <div class="empty-state">
        <div class="empty-state__icon" style="font-size: 64px;">ğŸ”’</div>
        <h2 class="empty-state__title" style="font-size: 24px; margin-top: 24px;">Aucune caisse ouverte</h2>
        <p class="empty-state__description" style="max-width: 400px; margin: 12px auto 32px;">
            Pour commencer Ã  enregistrer des paiements et des dÃ©penses, vous devez d'abord ouvrir une caisse.
        </p>
        <a href="{% url 'payments:ouvrir_caisse' %}" class="btn btn--primary btn--lg">
            ğŸ”“ Ouvrir une nouvelle caisse
        </a>
    </div>
</div>

<!-- Historique des caisses -->
<div class="card" style="margin-top: 24px;">
    <div class="card__header">
        <h3 class="card__title">ğŸ“ Historique des caisses</h3>
        <a href="{% url 'payments:liste_caisses' %}" class="btn btn--sm btn--ghost">Voir tout</a>
    </div>
    <p style="color: var(--text-secondary); padding: 20px 0;">
        Consultez l'historique des caisses prÃ©cÃ©dentes pour voir les rapports et statistiques.
    </p>
</div>
{% endif %}
{% endblock %}
