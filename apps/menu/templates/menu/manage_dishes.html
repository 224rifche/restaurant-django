{% extends 'base.html' %}
{% load gnf %}

{% block title %}GÃ©rer le menu{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div>
        <h1 class="page-title">ğŸ´ Gestion du Menu</h1>
        <p class="page-subtitle">Ajoutez, modifiez et gÃ©rez vos plats</p>
    </div>
    <div class="btn-group">
        <a href="{% url 'menu:manage_categories' %}" class="btn btn--ghost">ğŸ“‚ CatÃ©gories</a>
        <a href="{% url 'menu:create_dish' %}" class="btn btn--primary">+ Nouveau plat</a>
    </div>
</div>

<!-- Stats -->
<div class="stats-grid">
    <div class="stat-card stat-card--primary">
        <div class="stat-card__icon">ğŸ½ï¸</div>
        <div class="stat-card__value">{{ plats|length }}</div>
        <div class="stat-card__label">Total plats</div>
    </div>
    <div class="stat-card stat-card--success">
        <div class="stat-card__icon">âœ…</div>
        <div class="stat-card__value" id="plats-dispo">-</div>
        <div class="stat-card__label">Disponibles</div>
    </div>
    <div class="stat-card stat-card--danger">
        <div class="stat-card__icon">âŒ</div>
        <div class="stat-card__value" id="plats-indispo">-</div>
        <div class="stat-card__label">Indisponibles</div>
    </div>
</div>

<!-- Liste des plats -->
<div class="card">
    <div class="card__header">
        <h3 class="card__title">ğŸ“‹ Liste des plats</h3>
    </div>
    
    {% if plats %}
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Plat</th>
                    <th>Prix</th>
                    <th>Statut</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for plat in plats %}
                <tr class="{% if not plat.disponible %}plat-indispo{% endif %}">
                    <td>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            {% if plat.image and plat.image.name != 'plats/default.jpg' %}
                            <img src="{{ plat.image.url }}" alt="{{ plat.nom }}" style="width: 48px; height: 48px; border-radius: 8px; object-fit: cover;">
                            {% else %}
                            <div style="width: 48px; height: 48px; border-radius: 8px; background: var(--bg-input); display: flex; align-items: center; justify-content: center; font-size: 20px;">ğŸ½ï¸</div>
                            {% endif %}
                            <div>
                                <strong>{{ plat.nom }}</strong>
                                {% if plat.description %}
                                <p style="margin: 4px 0 0; font-size: 12px; color: var(--text-muted);">{{ plat.description|truncatechars:50 }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td>
                        <strong style="color: var(--accent-primary);">{{ plat.prix_unitaire|gnf }}</strong>
                    </td>
                    <td>
                        {% if plat.disponible %}
                            <span class="badge badge--success">âœ… Disponible</span>
                        {% else %}
                            <span class="badge badge--danger">âŒ Indisponible</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="btn-group">
                            <a class="btn btn--sm btn--ghost" href="{% url 'menu:update_dish' plat.id %}">âœï¸ Modifier</a>
                            <form method="post" action="{% url 'menu:toggle_dish_availability' plat.id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn--sm {% if plat.disponible %}btn--warning{% else %}btn--success{% endif %}">
                                    {% if plat.disponible %}ğŸ”’ DÃ©sactiver{% else %}ğŸ”“ Activer{% endif %}
                                </button>
                            </form>
                            {% if request.user.role == 'Radmin' %}
                            <a class="btn btn--sm btn--danger" href="{% url 'menu:delete_dish' plat.id %}">ğŸ—‘ï¸</a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-state__icon">ğŸ½ï¸</div>
        <h3 class="empty-state__title">Aucun plat</h3>
        <p class="empty-state__description">CrÃ©ez votre premier plat pour commencer</p>
        <a href="{% url 'menu:create_dish' %}" class="btn btn--primary">+ CrÃ©er un plat</a>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let dispo = 0, indispo = 0;
    document.querySelectorAll('tbody tr').forEach(tr => {
        if (tr.classList.contains('plat-indispo')) indispo++;
        else dispo++;
    });
    document.getElementById('plats-dispo').textContent = dispo;
    document.getElementById('plats-indispo').textContent = indispo;
});
</script>
{% endblock %}
