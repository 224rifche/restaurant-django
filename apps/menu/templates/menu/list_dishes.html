{% extends 'base.html' %}
{% load gnf %}

{% block title %}Menu{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div>
        <h1 class="page-title">üç¥ Notre Menu</h1>
        <p class="page-subtitle">D√©couvrez nos d√©licieux plats</p>
    </div>
    {% if categories %}
    <div class="card" style="margin-bottom: 16px;">
        <div class="card__content">
            <div class="filter-group" style="flex-wrap: wrap;">
                <a href="?{% if q %}q={{ q }}{% endif %}" class="btn btn--sm {% if not selected_cat %}btn--primary{% else %}btn--ghost{% endif %}">Toutes</a>
                {% for cat in categories %}
                    <a href="?cat={{ cat }}{% if q %}&q={{ q }}{% endif %}" class="btn btn--sm {% if selected_cat == cat %}btn--primary{% else %}btn--ghost{% endif %}">{{ cat }}</a>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
    <div class="btn-group">
        <a href="{% url 'orders:view_cart' %}" class="btn btn--primary">üõí Voir mon panier</a>
    </div>
</div>

<div class="card" style="margin-bottom: 18px;">
    <div class="card__content">
        <form method="get" class="search-form" style="margin-bottom: 16px;">
            {% if selected_cat %}
                <input type="hidden" name="cat" value="{{ selected_cat }}" />
            {% endif %}
            <input type="search" name="q" value="{{ q|default:'' }}" placeholder="Rechercher un plat..." class="input" />
            <button type="submit" class="btn btn--primary">Rechercher</button>
        </form>
        {% if q %}
            <a href="?" class="btn btn--ghost">‚úñÔ∏è Effacer</a>
        {% endif %}
    </div>
</div>

<!-- Grille des plats -->
<div class="menu-grid">
    {% for plat in plats %}
    <div class="menu-item">
        {% if plat.image and plat.image.name != 'plats/default.jpg' %}
        <img src="{{ plat.image.url }}" alt="{{ plat.nom }}" class="menu-item__image">
        {% else %}
        <div class="menu-item__image" style="display: flex; align-items: center; justify-content: center; background: var(--bg-input); font-size: 48px;">
            üçΩÔ∏è
        </div>
        {% endif %}
        <div class="menu-item__content">
            <h3 class="menu-item__name">{{ plat.nom }}</h3>
            {% if plat.description %}
            <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 12px;">
                {{ plat.description|truncatechars:80 }}
            </p>
            {% endif %}
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <span class="menu-item__price">{{ plat.prix_unitaire|gnf }}</span>
                <form action="{% url 'orders:add_to_cart' plat.id %}" method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="quantite" value="1">
                    <button type="submit" class="btn btn--primary btn--sm">üõí Ajouter</button>
                </form>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="empty-state" style="grid-column: 1 / -1;">
        <div class="empty-state__icon">üçΩÔ∏è</div>
        <h3 class="empty-state__title">Aucun plat disponible</h3>
        <p class="empty-state__description">Le menu sera bient√¥t disponible</p>
    </div>
    {% endfor %}
</div>
{% endblock %}
